---
layout:     post
title:      Opennebula
subtitle:   Opennebula部署安装与维护心得
date:       2017-07-27
author:     CDX
header-img: img/post-bg-debug.png
catalog: true
tags:
    - 效率
    - 终端
    - zsh
---
>搞了大半年的OpenNebula，今天阿里面试的时候突然让我讲一讲，瞬间懵逼，不知道该如何说起。这么长的时间，只顾着闷着头弄，没有一点总结，真的 是学而不思则罔了。
  
## 第一次
  
记得第一次安装是在17年寒假完成的，那时对于云计算没有太大的感触，或许可以说完全没有概念，安装的过程中出现了很多的问题，当时对于Linux系统不熟悉，甚至还没有自己安装过数据库，硬着头皮上。  

第一次部署成功使用的是SQLite数据库，比较简单，后来为了保证并发和稳定，改换MySQL，在安装数据库的过程中同样学习到了许多。
  
安装过程耗费了大概有几天吧，后来就开始摸索如何使用，不得不说摸索如何使用的过程一点也不比安装部署简单，对于这样的开源项目来讲，使用和维护是更加困难的过程。

## 第一台虚拟机(Centos)
  
安装部署成功之后，就急切的希望可以实现自己的初衷，创建第一台虚拟机，当时对于云的使用还停留在kvm、vm阶段，像OpenNebula这样的私有云是没有接触过的。  
  
按照官方教程的指导，我们没有找到有效的途径，应该是我们的前进方向和阅读能力的问题。

而后在博客中找到了三篇教程，第一篇是如何创建磁盘，第二篇是如何上传镜像，第三篇是如何制作模板。这三篇博客是同一个人写的，但是当时的排版确实是比较乱，只能根据这三篇仅有的指导来不停地尝试，第一次看到安装界面，当时激动了半天，但是你知道的，有的人喜怒不行于色，比如我，强忍着欣喜和激动，静静的等待安装界面的完成。
  
安装后的centos欢迎界面格外的好看，但是有一个致命问题---没有网络。

## 第一个网桥
  
当时有两种方案作为参考，一个是使用网桥方式将虚拟机直接接入网络，第二种是搭建OpenSwitch服务器，由于第二种方案心里没有底气，搭建一个OpenSwitch鬼知道要踩多少坑，花多少时间。  
  
本着快速并偷懒的心里，果断选择网桥，在禁掉Centos网卡的那一刻总觉得会有意外发生，果然不出所料，网络启动失败。还原网络配置文件，重启成功，继续改，重启失败，还原，成功，不停一天的时间。
  
到了第二天，早上来到办公室定了定神，发现了一篇简书上边的关于网桥的文章，一向觉得简书是挺靠谱的，所以果断拿到机房去试，配置文件改掉，怀着忐忑的心情重启网络服务，一次成功。
  
至此，虚拟机终于可以正常运行。

## 第一个启动脚本

OpenNebula的sunstone服务中已经提供了一些OS的镜像，对于使用者来说可以方便的下载，但是当时有一个问题就是我们并不知道网络映像的root密码，导致映像下载之后根本无法登入。

继续Google，在其官方论坛里面发现了一种方法，就是添加开机启动脚本，自动修改root密码，从网上copy了代码，输入到模板的启动脚本框里面，实例化虚拟机，发现虚拟机根本无法boot，一直在等待，不知道是哪里的问题，工作陷入停滞。

问题嘛，总是会解决的，不知道第几次尝试的时候，我突发奇想的去掉了启动脚本的base 64加密，这个看似差不多的模板就创建成功了，毫无防备的把问题给解决掉了。

## 第一台Windows虚拟机

在完成了一点点成就的时候，容易飘，非常容易飘，觉得Linux都成功了，window应该不难，结果被打脸，狠狠的打脸，Window虚拟机的部署耗费了老长时间也没有真正的完成，首先创建就耗费了比较长时间，当时我是拿Windows7做测试的，好不容易安装好之后有没有网卡驱动等等。反正相对于Linux系统的部署是复杂了许多。
  
发现自己真的是Too 

## 迁移
![view](http://http://blog.chinaunix.net/attachment/201302/7/20940095_1360212621wRw5.jpg)